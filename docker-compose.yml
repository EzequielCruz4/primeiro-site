version: '3.8'

services:
    # 1. Contêiner da Aplicação (PHP-FPM)
    app:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: laravel_app_php
        # VOLUME CRUCIAL: Mapeia a pasta do seu projeto local para dentro do contêiner.
        # Qualquer modificação local é refletida instantaneamente no contêiner.
        volumes:
            - .:/var/www/html
        working_dir: /var/www/html
        environment:
            - APP_ENV=local
            - APP_DEBUG=true

    # 2. Contêiner do Servidor Web (Nginx)
    nginx:
        image: nginx:stable-alpine
        container_name: laravel_app_nginx
        # Mapeia a porta 8080 do seu Umbrel para a porta 80 do contêiner Nginx
        ports:
            - '8080:80'
        volumes:
            # Mapeia o projeto (só leitura) para que o Nginx acesse os arquivos estáticos
            - .:/var/www/html:ro
            # Mapeia o arquivo de configuração Nginx que criamos
            - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
        depends_on:
            - app # Garante que o PHP-FPM esteja rodando antes do Nginx
